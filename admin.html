<!DOCTYPE html>
<html lang="zh-CN" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Xpat - 管理后台</title>
    <link rel="stylesheet" href="css/style.css?v=1.3">
    <link rel="stylesheet" href="css/dark-theme.css?v=1.3">
    <link rel="stylesheet" href="css/light-theme.css?v=1.3">
    <link rel="stylesheet" href="css/admin.css?v=1.0">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQgMkM3LjM3MyAyIDIgNy4zNzMgMiAxNEMyIDIwLjYyNyA3LjM3MyAyNiAxNCAyNkMyMC42MjcgMjYgMjYgMjAuNjI3IDI2IDE0QzI2IDcuMzczIDIwLjYyNyAyIDE0IDJaTTE0IDVDMTguNDE4IDUgMjIgOC41ODIgMjIgMTNDMjIgMTcuNDE4IDE4LjQxOCAyMSAxNCAyMUM5LjU4MiAyMSA2IDE3LjQxOCA2IDEzQzYgOC41ODIgOS41ODIgNSAxNCA1WiIgZmlsbD0iIzU4NjVmMiIvPjwvc3ZnPg==" type="image/svg+xml">
</head>
<body class="dark-theme">
    <!-- 顶部导航栏 -->
    <header class="navbar">
        <div class="logo">
            <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2C7.373 2 2 7.373 2 14C2 20.627 7.373 26 14 26C20.627 26 26 20.627 26 14C26 7.373 20.627 2 14 2ZM14 5C18.418 5 22 8.582 22 13C22 17.418 18.418 21 14 21C9.582 21 6 17.418 6 13C6 8.582 9.582 5 14 5Z" fill="white"/>
            </svg>
            <span>Xpat 管理后台</span>
        </div>
        <div class="nav-controls">
            <button class="icon-btn theme-toggle-btn" id="themeToggle" title="切换主题">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="theme-icon">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" fill="currentColor"/>
                </svg>
            </button>
            <a href="index.html" class="nav-link" title="返回前台">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </a>
            <button class="icon-btn logout-btn" id="logoutBtn" title="退出登录" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 16L21 12M21 12L17 8M21 12H7M13 16V17C13 18.6569 11.6569 20 10 20H6C4.34315 20 3 18.6569 3 17V7C3 5.34315 4.34315 4 6 4H10C11.6569 4 13 5.34315 13 7V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main>
        <!-- 登录表单 -->
        <div id="loginContainer" class="admin-container">
            <div class="card">
                <h2>管理员登录</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email">邮箱</label>
                        <input type="email" id="email" required placeholder="请输入管理员邮箱">
                    </div>
                    <div class="form-group">
                        <label for="password">密码</label>
                        <input type="password" id="password" required placeholder="请输入密码">
                    </div>
                    <div class="form-error" id="loginError"></div>
                    <button type="submit" class="btn btn-primary">登录</button>
                </form>
            </div>
        </div>

        <!-- 管理后台内容 -->
        <div id="adminContent" style="display: none;">
            <!-- 侧边栏菜单 -->
            <aside class="sidebar">
                <ul class="menu">
                    <li class="menu-item active" data-section="promptsManagement">提示词管理</li>
                    <li class="menu-item" data-section="apiConfig">API配置</li>
                    <li class="menu-item" data-section="userManagement">用户管理</li>
                    <li class="menu-item" data-section="subscriptionManagement">订阅管理</li>
                    <li class="menu-item" data-section="apiUsage">API使用统计</li>
                </ul>
            </aside>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 提示词管理 -->
                <section id="promptsManagement" class="admin-section">
                    <div class="section-header">
                        <h2>提示词管理</h2>
                        <button class="btn btn-primary" id="addPromptBtn">新增提示词</button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <label for="promptCategoryFilter">分类筛选</label>
                            <select id="promptCategoryFilter">
                                <option value="">所有分类</option>
                                <option value="general">通用对话</option>
                                <option value="patent-search">专利检索</option>
                                <option value="patent-writing">专利撰写</option>
                                <option value="patent-analysis">专利分析</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="promptsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>分类</th>
                                    <th>公开状态</th>
                                    <th>创建者</th>
                                    <th>创建时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="promptsEmptyState" style="display: none;">
                            <p>暂无数据</p>
                        </div>
                        <div class="loading-state" id="promptsLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>

                <!-- API配置 -->
                <section id="apiConfig" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>AI模型API配置</h2>
                        <button class="btn btn-primary" id="saveApiConfigBtn">保存配置</button>
                    </div>
                    
                    <div class="card api-config-card">
                        <form id="apiConfigForm">
                            <div class="form-group">
                                <h3>系统配置</h3>
                                <label for="backendApiUrl">后端API地址</label>
                                <input type="text" id="backendApiUrl" placeholder="http://localhost:3000/api">
                                
                                <label for="defaultProvider">默认AI提供商</label>
                                <select id="defaultProvider">
                                    <option value="openai">OpenAI</option>
                                    <option value="anthropic">Anthropic</option>
                                    <option value="openrouter">OpenRouter</option>
                                </select>
                                
                                <div class="form-check">
                                    <input type="checkbox" id="allowUserModelSelection">
                                    <label for="allowUserModelSelection">允许用户选择模型</label>
                                </div>
                            </div>
                            
                            <hr class="divider">
                            
                            <div class="form-group">
                                <h3>OpenAI API配置</h3>
                                <label for="openaiApiKey">API密钥</label>
                                <input type="password" id="openaiApiKey" placeholder="sk-...">
                                
                                <label for="openaiModel">默认模型</label>
                                <select id="openaiModel">
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                </select>
                                
                                <label for="openaiEndpoint">API端点 (可选)</label>
                                <input type="text" id="openaiEndpoint" placeholder="https://api.openai.com/v1">
                            </div>
                            
                            <hr class="divider">
                            
                            <div class="form-group">
                                <h3>OpenRouter API配置</h3>
                                <label for="openrouterApiKey">API密钥</label>
                                <input type="password" id="openrouterApiKey" placeholder="sk-or-v1-..." value="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">
                                
                                <label for="openrouterModel">默认模型</label>
                                <select id="openrouterModel">
                                    <option value="deepseek/deepseek-r1:free">DeepSeek R1 (免费)</option>
                                    <option value="anthropic/claude-3-opus:beta">Claude 3 Opus</option>
                                    <option value="anthropic/claude-3-sonnet:beta">Claude 3 Sonnet</option>
                                    <option value="anthropic/claude-3-haiku:beta">Claude 3 Haiku</option>
                                    <option value="mistralai/mistral-large:latest">Mistral Large</option>
                                    <option value="google/gemini-pro:latest">Google Gemini Pro</option>
                                </select>
                                
                                <label for="openrouterEndpoint">API端点</label>
                                <input type="text" id="openrouterEndpoint" placeholder="https://openrouter.ai/api/v1/chat/completions" value="https://openrouter.ai/api/v1/chat/completions">
                                
                                <label for="openrouterReferer">HTTP-Referer</label>
                                <input type="text" id="openrouterReferer" placeholder="http://localhost" value="http://localhost">
                                
                                <label for="openrouterTitle">X-Title</label>
                                <input type="text" id="openrouterTitle" placeholder="AI Chat Application" value="AI Chat Test">
                            </div>
                            
                            <hr class="divider">
                            
                            <div class="form-group">
                                <h3>Anthropic API配置</h3>
                                <label for="anthropicApiKey">API密钥</label>
                                <input type="password" id="anthropicApiKey" placeholder="sk-ant-...">
                                
                                <label for="anthropicModel">默认模型</label>
                                <select id="anthropicModel">
                                    <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                                    <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                                </select>
                                
                                <label for="anthropicEndpoint">API端点 (可选)</label>
                                <input type="text" id="anthropicEndpoint" placeholder="https://api.anthropic.com">
                            </div>
                            
                            <hr class="divider">
                            
                            <div class="form-note">
                                <p>注意: API密钥将以加密方式存储在服务器端，并用于向AI提供商发送请求。</p>
                            </div>
                            
                            <div class="form-error" id="apiConfigError"></div>
                        </form>
                    </div>
                </section>

                <!-- 用户管理 -->
                <section id="userManagement" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>用户管理</h2>
                        <button class="btn btn-primary" id="addUserBtn">新增用户</button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <select id="userRoleFilter">
                                <option value="">所有角色</option>
                                <option value="admin">管理员</option>
                                <option value="user">普通用户</option>
                            </select>
                        </div>
                        <div class="search-box">
                            <input type="text" id="userSearchInput" placeholder="搜索用户名或邮箱...">
                            <button id="userSearchBtn" class="btn btn-secondary">搜索</button>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>角色</th>
                                    <th>API配额</th>
                                    <th>API使用量</th>
                                    <th>注册时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="usersEmptyState" style="display: none;">
                            <p>暂无数据</p>
                        </div>
                        <div class="loading-state" id="usersLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                    
                    <div class="pagination" id="usersPagination">
                        <button class="pagination-btn" id="prevPageBtn" disabled>&laquo; 上一页</button>
                        <span class="pagination-info">第 <span id="currentPage">1</span> 页，共 <span id="totalPages">1</span> 页</span>
                        <button class="pagination-btn" id="nextPageBtn" disabled>下一页 &raquo;</button>
                    </div>
                </section>

                <!-- 订阅管理 -->
                <section id="subscriptionManagement" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>订阅管理</h2>
                        <button class="btn btn-primary" id="addSubscriptionBtn">新增订阅计划</button>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stats-card">
                            <h3>总订阅数</h3>
                            <div class="stats-value" id="totalSubscriptionsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>活跃订阅</h3>
                            <div class="stats-value" id="activeSubscriptionsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>月收入</h3>
                            <div class="stats-value" id="monthlyRevenueValue">--</div>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="subscriptionsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>价格</th>
                                    <th>有效期(天)</th>
                                    <th>API配额</th>
                                    <th>订阅数</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="subscriptionsEmptyState" style="display: none;">
                            <p>暂无订阅计划</p>
                        </div>
                        <div class="loading-state" id="subscriptionsLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>

                <!-- API使用统计 -->
                <section id="apiUsage" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>API使用统计</h2>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stats-card">
                            <h3>今日API调用</h3>
                            <div class="stats-value" id="todayApiCallsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>总API调用</h3>
                            <div class="stats-value" id="totalApiCallsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>活跃用户</h3>
                            <div class="stats-value" id="activeUsersValue">--</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-card">
                            <h3>每日API调用</h3>
                            <div class="chart" id="dailyApiCallsChart">
                                <div class="placeholder-chart">
                                    <p>图表加载中...</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>模型使用分布</h3>
                            <div class="chart" id="modelDistributionChart">
                                <div class="placeholder-chart">
                                    <p>图表加载中...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-header subsection-header">
                        <h3>用户API使用排行</h3>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="apiUsageTable">
                            <thead>
                                <tr>
                                    <th>用户ID</th>
                                    <th>用户名</th>
                                    <th>API调用次数</th>
                                    <th>配额使用比例</th>
                                    <th>常用模型</th>
                                    <th>上次使用时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="apiUsageEmptyState" style="display: none;">
                            <p>暂无API使用数据</p>
                        </div>
                        <div class="loading-state" id="apiUsageLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- 模态框 -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">提示词编辑</h3>
                <button class="close-modal" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="promptForm">
                    <input type="hidden" id="promptId">
                    <div class="form-group">
                        <label for="promptName">名称</label>
                        <input type="text" id="promptName" required placeholder="提示词名称">
                    </div>
                    <div class="form-group">
                        <label for="promptCategory">分类</label>
                        <select id="promptCategory" required>
                            <option value="general">通用对话</option>
                            <option value="patent-search">专利检索</option>
                            <option value="patent-writing">专利撰写</option>
                            <option value="patent-analysis">专利分析</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="promptContent">内容</label>
                        <textarea id="promptContent" rows="8" required placeholder="输入提示词内容..."></textarea>
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="promptIsPublic">
                            <span>公开提示词（所有用户可见）</span>
                        </label>
                    </div>
                    <div class="form-error" id="promptFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPromptBtn">取消</button>
                <button class="btn btn-primary" id="savePromptBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="deleteModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="close-modal" id="closeDeleteModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除这个提示词吗？此操作无法撤销。</p>
                <input type="hidden" id="deletePromptId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- 用户编辑模态框 -->
    <div id="userModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="userModalTitle">用户编辑</h3>
                <button class="close-modal" id="closeUserModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    <div class="form-group">
                        <label for="userUsername">用户名</label>
                        <input type="text" id="userUsername" readonly>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">邮箱</label>
                        <input type="email" id="userEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label for="userRole">角色</label>
                        <select id="userRole">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="userApiQuota">API配额</label>
                        <input type="number" id="userApiQuota" min="0" step="10">
                    </div>
                    <div class="form-error" id="userFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUserBtn">取消</button>
                <button class="btn btn-primary" id="saveUserBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 角色修改确认模态框 -->
    <div id="roleConfirmModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认角色修改</h3>
                <button class="close-modal" id="closeRoleConfirmModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>您确定要将用户 <span id="roleChangeUsername"></span> 的角色从 <span id="roleChangeOld"></span> 修改为 <span id="roleChangeNew"></span> 吗？</p>
                <p class="warning-text">此操作会影响用户的权限，请谨慎操作。</p>
                <input type="hidden" id="roleChangeUserId">
                <input type="hidden" id="roleChangeValue">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRoleChangeBtn">取消</button>
                <button class="btn btn-primary" id="confirmRoleChangeBtn">确认修改</button>
            </div>
        </div>
    </div>

    <!-- 订阅计划编辑模态框 -->
    <div id="subscriptionModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="subscriptionModalTitle">订阅计划编辑</h3>
                <button class="close-modal" id="closeSubscriptionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="subscriptionForm">
                    <input type="hidden" id="subscriptionId">
                    <div class="form-group">
                        <label for="subscriptionName">名称</label>
                        <input type="text" id="subscriptionName" required placeholder="订阅计划名称">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionPrice">价格 (元/月)</label>
                        <input type="number" id="subscriptionPrice" min="0" step="0.01" required placeholder="月度价格">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionDuration">有效期 (天)</label>
                        <input type="number" id="subscriptionDuration" min="1" required placeholder="默认30天">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionApiQuota">API调用配额</label>
                        <input type="number" id="subscriptionApiQuota" min="1" required placeholder="API调用次数">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionFeatures">功能列表</label>
                        <div class="feature-list" id="featureList">
                            <div class="feature-item">
                                <input type="text" placeholder="功能描述">
                                <button type="button" class="btn-icon remove-feature">×</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" id="addFeatureBtn">添加功能</button>
                    </div>
                    <div class="form-error" id="subscriptionFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSubscriptionBtn">取消</button>
                <button class="btn btn-primary" id="saveSubscriptionBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 删除订阅确认模态框 -->
    <div id="deleteSubscriptionModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="close-modal" id="closeDeleteSubscriptionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除这个订阅计划吗？此操作无法撤销，且可能影响已使用此计划的用户。</p>
                <input type="hidden" id="deleteSubscriptionId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteSubscriptionBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteSubscriptionBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- 删除用户确认模态框 -->
    <div id="deleteUserModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除用户</h3>
                <button class="close-modal" id="closeDeleteUserModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除用户 <span id="deleteUserName"></span> 吗？</p>
                <p class="warning-text">此操作无法撤销，用户的所有数据将被永久删除。</p>
                <input type="hidden" id="deleteUserId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteUserBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteUserBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- 新增用户模态框 -->
    <div id="addUserModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>新增用户</h3>
                <button class="close-modal" id="closeAddUserModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">用户名</label>
                        <input type="text" id="newUsername" required placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="newEmail">邮箱</label>
                        <input type="email" id="newEmail" required placeholder="请输入邮箱">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">密码</label>
                        <input type="password" id="newPassword" required placeholder="请输入密码">
                    </div>
                    <div class="form-group">
                        <label for="newRole">角色</label>
                        <select id="newRole">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newApiQuota">API配额</label>
                        <input type="number" id="newApiQuota" min="0" step="10" value="100">
                    </div>
                    <div class="form-error" id="addUserFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddUserBtn">取消</button>
                <button class="btn btn-primary" id="saveAddUserBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="js/theme.js?v=1.3"></script>
    <script src="js/backend-api.js?v=1.0"></script>
    <!-- 引入Chart.js图表库 - 多个CDN源，确保可用性 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- 备选CDN源 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- 本地回退方案 - 确保Chart.js对象存在 -->
    <script>
        // 检查Chart对象是否已加载
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js库加载失败，尝试使用本地方案');
                // 显示错误信息在图表容器中
                const chartContainers = document.querySelectorAll('.chart');
                chartContainers.forEach(container => {
                    container.innerHTML = '<div class="placeholder-chart"><p>图表库加载失败，请检查网络连接</p></div>';
                });
            } else {
                console.log('Chart.js库加载成功，版本:', Chart.version);
            }
        });
    </script>
    <script src="js/admin.js?v=1.0"></script>
</body>
</html> 