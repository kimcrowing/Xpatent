<!DOCTYPE html>
<html lang="zh-CN" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Xpat - 管理后台</title>
    <link rel="stylesheet" href="css/style.css?v=1.3">
    <link rel="stylesheet" href="css/dark-theme.css?v=1.3">
    <link rel="stylesheet" href="css/light-theme.css?v=1.3">
    <link rel="stylesheet" href="css/admin.css?v=1.0">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQgMkM3LjM3MyAyIDIgNy4zNzMgMiAxNEMyIDIwLjYyNyA3LjM3MyAyNiAxNCAyNkMyMC42MjcgMjYgMjYgMjAuNjI3IDI2IDE0QzI2IDcuMzczIDIwLjYyNyAyIDE0IDJaTTE0IDVDMTguNDE4IDUgMjIgOC41ODIgMjIgMTNDMjIgMTcuNDE4IDE4LjQxOCAyMSAxNCAyMUM5LjU4MiAyMSA2IDE3LjQxOCA2IDEzQzYgOC41ODIgOS41ODIgNSAxNCA1WiIgZmlsbD0iIzU4NjVmMiIvPjwvc3ZnPg==" type="image/svg+xml">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        /* API密钥管理样式 */
        .api-keys-container {
            border-radius: 5px;
            background-color: #f8f9fa;
            padding: 15px;
            margin-top: 10px;
        }
        
        .api-keys-list {
            margin-bottom: 10px;
        }
        
        .api-keys-table {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .api-key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #ccc;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }
        
        .api-key-item.active {
            border-left-color: #28a745;
        }
        
        .api-key-item.inactive {
            border-left-color: #dc3545;
            opacity: 0.7;
        }
        
        .api-key-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .api-key-provider {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .api-key-status {
            font-size: 0.9em;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
            background-color: #e9ecef;
        }
        
        .api-key-item.active .api-key-status {
            color: #28a745;
        }
        
        .api-key-item.inactive .api-key-status {
            color: #dc3545;
        }
        
        .api-key-date {
            font-size: 0.85em;
            color: #6c757d;
        }
        
        .api-key-actions {
            display: flex;
            gap: 5px;
        }
        
        .loading-indicator {
            text-align: center;
            padding: 10px;
            color: #6c757d;
        }
        
        .empty-message {
            text-align: center;
            padding: 15px;
            color: #6c757d;
            font-style: italic;
        }
        
        .error-message {
            color: #dc3545;
            margin-top: 10px;
        }
    </style>
</head>
<body class="dark-theme">
    <!-- 顶部导航栏 -->
    <header class="navbar">
        <div class="logo">
            <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2C7.373 2 2 7.373 2 14C2 20.627 7.373 26 14 26C20.627 26 26 20.627 26 14C26 7.373 20.627 2 14 2ZM14 5C18.418 5 22 8.582 22 13C22 17.418 18.418 21 14 21C9.582 21 6 17.418 6 13C6 8.582 9.582 5 14 5Z" fill="white"/>
            </svg>
            <span>Xpat 管理后台</span>
        </div>
        <div class="nav-controls">
            <button class="icon-btn theme-toggle-btn" id="themeToggle" title="切换主题">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="theme-icon">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" fill="currentColor"/>
                </svg>
            </button>
            <a href="index.html" class="nav-link" title="返回前台">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </a>
            <button class="icon-btn logout-btn" id="logoutBtn" title="退出登录" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 16L21 12M21 12L17 8M21 12H7M13 16V17C13 18.6569 11.6569 20 10 20H6C4.34315 20 3 18.6569 3 17V7C3 5.34315 4.34315 4 6 4H10C11.6569 4 13 5.34315 13 7V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main>
        <!-- 登录表单 -->
        <div id="loginContainer" class="admin-container">
            <div class="card">
                <h2>管理员登录</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email">邮箱</label>
                        <input type="email" id="email" required placeholder="请输入管理员邮箱">
                    </div>
                    <div class="form-group">
                        <label for="password">密码</label>
                        <input type="password" id="password" required placeholder="请输入密码">
                    </div>
                    <div class="form-error" id="loginError"></div>
                    <button type="submit" class="btn btn-primary">登录</button>
                </form>
            </div>
        </div>

        <!-- 管理后台内容 -->
        <div id="adminContent" style="display: none;">
            <!-- 侧边栏菜单 -->
            <aside class="sidebar">
                <div class="brand">
                    <img src="images/logo.png" alt="Xpat Logo">
                    <h1>Xpat 管理后台</h1>
                </div>
                <nav>
                    <ul>
                        <li data-tab="dashboard" class="active">
                            <span class="icon">📊</span>
                            <span>仪表盘</span>
                        </li>
                        <li data-tab="promptsManagement">
                            <span class="icon">💬</span>
                            <span>提示词管理</span>
                        </li>
                        <li data-tab="apiConfig">
                            <span class="icon">⚙️</span>
                            <span>API配置</span>
                        </li>
                        <li data-tab="chatModeManagement">
                            <span class="icon">💬</span>
                            <span>对话模式管理</span>
                        </li>
                        <li data-tab="userManagement">
                            <span class="icon">👥</span>
                            <span>用户管理</span>
                        </li>
                        <li data-tab="userFeaturesConfig">
                            <span class="icon">🔒</span>
                            <span>用户功能配置</span>
                        </li>
                        <li data-tab="subscriptionManagement">
                            <span class="icon">💳</span>
                            <span>订阅管理</span>
                        </li>
                        <li data-tab="apiUsage">
                            <span class="icon">📈</span>
                            <span>API使用统计</span>
                        </li>
                        <li data-tab="apiKeysManagement">
                            <span class="icon">🔑</span>
                            <span>API密钥管理</span>
                        </li>
                        <li data-tab="settingsManagement">
                            <span class="icon">⚙️</span>
                            <span>系统设置</span>
                        </li>
                        <li data-tab="adminLogs">
                            <span class="icon">📝</span>
                            <span>管理员日志</span>
                        </li>
                    </ul>
                </nav>
                <div class="user-info">
                    <div class="avatar">👤</div>
                    <div class="user-details">
                        <div class="username">管理员</div>
                        <div class="role">系统管理员</div>
                    </div>
                    <button id="logoutBtn" class="logout-btn">退出</button>
                </div>
            </aside>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 仪表盘部分 -->
                <section id="dashboard" class="admin-section">
                    <div class="section-header">
                        <h2>系统仪表盘</h2>
                        <div class="actions">
                            <button class="btn btn-outline" id="refreshDashboardBtn" title="刷新数据">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4m-4 4a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
                                </svg>
                                刷新
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline dropdown-toggle" id="dashboardPeriodBtn">
                                    <span>最近7天</span>
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 9l6 6 6-6"></path>
                                    </svg>
                                </button>
                                <div class="dropdown-menu">
                                    <a href="#" data-period="7" class="active">最近7天</a>
                                    <a href="#" data-period="30">最近30天</a>
                                    <a href="#" data-period="90">最近90天</a>
                                    <a href="#" data-period="180">最近半年</a>
                                    <a href="#" data-period="365">最近一年</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 加载状态 -->
                    <div id="dashboardLoadingState" class="loading-state">
                        <div class="spinner"></div>
                        <p>正在加载仪表盘数据...</p>
                    </div>
                    
                    <!-- 错误状态 -->
                    <div id="dashboardErrorState" class="error-state" style="display: none;">
                        <div class="error-icon">⚠️</div>
                        <p>加载仪表盘数据失败</p>
                    </div>
                    
                    <!-- 数据概览卡片 -->
                    <div class="data-cards">
                        <div class="data-card">
                            <div class="card-icon">👥</div>
                            <div class="card-content">
                                <div class="card-title">总用户数</div>
                                <div class="card-value" id="totalUsersValue">--</div>
                                <div class="card-growth" id="totalUsersGrowth"></div>
                            </div>
                        </div>
                        <div class="data-card">
                            <div class="card-icon">🏃</div>
                            <div class="card-content">
                                <div class="card-title">活跃用户</div>
                                <div class="card-value" id="activeUsersValue">--</div>
                                <div class="card-growth" id="activeUsersGrowth"></div>
                            </div>
                        </div>
                        <div class="data-card">
                            <div class="card-icon">🔄</div>
                            <div class="card-content">
                                <div class="card-title">API总调用量</div>
                                <div class="card-value" id="totalApiCallsValue">--</div>
                                <div class="card-growth" id="totalApiCallsGrowth"></div>
                            </div>
                        </div>
                        <div class="data-card">
                            <div class="card-icon">📊</div>
                            <div class="card-content">
                                <div class="card-title">今日API调用</div>
                                <div class="card-value" id="todayApiCallsValue">--</div>
                                <div class="card-growth" id="todayApiCallsGrowth"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 用户统计 -->
                    <div class="dashboard-section">
                        <h3 class="section-title">用户统计</h3>
                        <div class="chart-container-group">
                            <div class="chart-container">
                                <h4>用户增长趋势</h4>
                                <canvas id="userGrowthChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>用户角色分布</h4>
                                <canvas id="userRoleChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>用户活跃度</h4>
                                <canvas id="userActivityChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- API使用统计 -->
                    <div class="dashboard-section">
                        <h3 class="section-title">API使用统计</h3>
                        <div class="chart-container-group">
                            <div class="chart-container">
                                <h4>API调用趋势</h4>
                                <canvas id="apiCallsChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>模型使用分布</h4>
                                <canvas id="modelUsageChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>配额使用排行</h4>
                                <canvas id="quotaUsageChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 订阅统计 -->
                    <div class="dashboard-section">
                        <h3 class="section-title">订阅统计</h3>
                        <div class="data-cards">
                            <div class="data-card">
                                <div class="card-icon">📝</div>
                                <div class="card-content">
                                    <div class="card-title">总订阅数</div>
                                    <div class="card-value" id="totalSubscriptionsValue">--</div>
                                </div>
                            </div>
                            <div class="data-card">
                                <div class="card-icon">✅</div>
                                <div class="card-content">
                                    <div class="card-title">活跃订阅</div>
                                    <div class="card-value" id="activeSubscriptionsValue">--</div>
                                </div>
                            </div>
                            <div class="data-card">
                                <div class="card-icon">💰</div>
                                <div class="card-content">
                                    <div class="card-title">月度收入</div>
                                    <div class="card-value" id="monthlyRevenueValue">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container-group">
                            <div class="chart-container">
                                <h4>订阅计划分布</h4>
                                <canvas id="subscriptionPlanChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>订阅趋势</h4>
                                <canvas id="subscriptionTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 提示词管理 -->
                <section id="promptsManagement" class="admin-section">
                    <div class="section-header">
                        <h2>提示词管理</h2>
                        <button class="btn btn-primary" id="addPromptBtn">新增提示词</button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <label for="promptCategoryFilter">分类筛选</label>
                            <select id="promptCategoryFilter">
                                <option value="">所有分类</option>
                                <option value="general">通用对话</option>
                                <option value="patent-search">专利检索</option>
                                <option value="patent-writing">专利撰写</option>
                                <option value="patent-analysis">专利分析</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="promptsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>分类</th>
                                    <th>公开状态</th>
                                    <th>创建者</th>
                                    <th>创建时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="promptsEmptyState" style="display: none;">
                            <p>暂无数据</p>
                        </div>
                        <div class="loading-state" id="promptsLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>

                <!-- 领域模板管理 -->
                <section id="domainTemplates" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>领域特定模板管理</h2>
                        <button class="btn btn-primary" id="addDomainTemplateBtn">新增领域模板</button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <label for="domainFilter">技术领域筛选</label>
                            <select id="domainFilter">
                                <option value="">所有技术领域</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modeFilter">对话模式筛选</label>
                            <select id="modeFilter">
                                <option value="">所有对话模式</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="domainTemplatesTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>技术领域</th>
                                    <th>对话模式</th>
                                    <th>名称</th>
                                    <th>创建时间</th>
                                    <th>更新时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- API配置 -->
                <section id="apiConfig" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>API配置管理</h2>
                    </div>
                    
                    <!-- 添加API提供商管理部分 -->
                    <div class="subsection-header">
                        <h3>API提供商管理</h3>
                        <button class="btn btn-primary btn-sm" id="addApiProviderBtn">添加提供商</button>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="apiProvidersTable">
                            <thead>
                                <tr>
                                    <th>提供商名称</th>
                                    <th>API端点</th>
                                    <th>支持模型数</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="apiProvidersEmptyState" style="display: none;">
                            <p>暂无API提供商数据</p>
                        </div>
                        <div class="loading-state" id="apiProvidersLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                    
                    <!-- 添加API模型管理部分 -->
                    <div class="subsection-header" style="margin-top: 30px;">
                        <h3>模型管理</h3>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="apiModelsTable">
                            <thead>
                                <tr>
                                    <th>模型名称</th>
                                    <th>提供商</th>
                                    <th>上下文大小</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="apiModelsEmptyState" style="display: none;">
                            <p>暂无模型数据</p>
                        </div>
                        <div class="loading-state" id="apiModelsLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                    
                    <!-- 添加全局API参数设置部分 -->
                    <div class="subsection-header" style="margin-top: 30px;">
                        <h3>全局API参数设置</h3>
                    </div>
                    
                    <div class="api-config-card">
                        <form id="globalApiConfigForm">
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="defaultApiProvider">默认API提供商</label>
                                    <select id="defaultApiProvider" class="form-control">
                                        <!-- 由JavaScript动态填充 -->
                                        <option value="">请选择默认提供商</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="defaultModel">默认模型</label>
                                    <select id="defaultModel" class="form-control">
                                        <!-- 由JavaScript动态填充 -->
                                        <option value="">请选择默认模型</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>API请求设置</label>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="defaultTemperature">默认温度</label>
                                        <input type="number" id="defaultTemperature" class="form-control" min="0" max="2" step="0.1" value="0.7">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="defaultMaxTokens">默认最大Tokens</label>
                                        <input type="number" id="defaultMaxTokens" class="form-control" min="100" max="32000" step="100" value="2000">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="requestTimeout">请求超时(秒)</label>
                                        <input type="number" id="requestTimeout" class="form-control" min="5" max="300" step="1" value="60">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <button type="submit" class="btn btn-primary" id="saveGlobalApiConfigBtn">保存设置</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- 用户管理 -->
                <section id="userManagement" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>用户管理</h2>
                        <button class="btn btn-primary" id="addUserBtn">新增用户</button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <select id="userRoleFilter">
                                <option value="">所有角色</option>
                                <option value="admin">管理员</option>
                                <option value="user">普通用户</option>
                            </select>
                        </div>
                        <div class="search-box">
                            <input type="text" id="userSearchInput" placeholder="搜索用户名或邮箱...">
                            <button id="userSearchBtn" class="btn btn-secondary">搜索</button>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>角色</th>
                                    <th>API配额</th>
                                    <th>API使用量</th>
                                    <th>注册时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="usersEmptyState" style="display: none;">
                            <p>暂无数据</p>
                        </div>
                        <div class="loading-state" id="usersLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                    
                    <div class="pagination" id="usersPagination">
                        <button class="pagination-btn" id="prevPageBtn" disabled>&laquo; 上一页</button>
                        <span class="pagination-info">第 <span id="currentPage">1</span> 页，共 <span id="totalPages">1</span> 页</span>
                        <button class="pagination-btn" id="nextPageBtn" disabled>下一页 &raquo;</button>
                    </div>
                </section>

                <!-- 用户功能配置 -->
                <section id="userFeaturesConfig" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>用户功能配置</h2>
                    </div>
                    
                    <div class="user-selector-container">
                        <div class="form-group">
                            <label for="userConfigSelector">选择用户</label>
                            <select id="userConfigSelector" class="form-control">
                                <option value="">请选择用户...</option>
                                <!-- 由JavaScript动态填充 -->
                            </select>
                        </div>
                    </div>
                    
                    <div id="userConfigContent" style="display: none;">
                        <div class="user-config-header">
                            <h3>配置用户: <span id="selectedUserName"></span></h3>
                            <button class="btn btn-primary" id="saveUserConfigBtn">保存配置</button>
                        </div>
                        
                        <div class="tabs-container">
                            <div class="tabs-header">
                                <div class="tab-item active" data-config-tab="chatModes">对话模式</div>
                                <div class="tab-item" data-config-tab="promptTemplates">提示词模板</div>
                                <div class="tab-item" data-config-tab="apiProviders">API供应商</div>
                                <div class="tab-item" data-config-tab="models">模型配置</div>
                            </div>
                            
                            <div class="tabs-content">
                                <!-- 对话模式配置 -->
                                <div class="tab-content active" id="chatModesConfig">
                                    <div class="table-toolbar">
                                        <span class="section-subtitle">可用对话模式</span>
                                        <div class="toolbar-actions">
                                            <button class="btn btn-sm btn-outline" id="selectAllChatModesBtn">全选</button>
                                            <button class="btn btn-sm btn-outline" id="unselectAllChatModesBtn">全不选</button>
                                        </div>
                                    </div>
                                    
                                    <div class="compact-table-container">
                                        <table class="compact-table" id="userChatModesTable">
                                            <thead>
                                                <tr>
                                                    <th style="width: 50px">启用</th>
                                                    <th>模式名称</th>
                                                    <th>描述</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- 由JavaScript动态填充 -->
                                                <tr>
                                                    <td colspan="3" class="text-center">加载中...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- 提示词模板配置 -->
                                <div class="tab-content" id="promptTemplatesConfig">
                                    <div class="table-toolbar">
                                        <span class="section-subtitle">可用提示词模板</span>
                                        <div class="toolbar-actions">
                                            <button class="btn btn-sm btn-outline" id="selectAllPromptsBtn">全选</button>
                                            <button class="btn btn-sm btn-outline" id="unselectAllPromptsBtn">全不选</button>
                                        </div>
                                    </div>
                                    
                                    <div class="compact-table-container">
                                        <table class="compact-table" id="userPromptsTable">
                                            <thead>
                                                <tr>
                                                    <th style="width: 50px">启用</th>
                                                    <th>模板名称</th>
                                                    <th>分类</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- 由JavaScript动态填充 -->
                                                <tr>
                                                    <td colspan="3" class="text-center">加载中...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- API供应商配置 -->
                                <div class="tab-content" id="apiProvidersConfig">
                                    <div class="table-toolbar">
                                        <span class="section-subtitle">可用API供应商</span>
                                        <div class="toolbar-actions">
                                            <button class="btn btn-sm btn-outline" id="selectAllProvidersBtn">全选</button>
                                            <button class="btn btn-sm btn-outline" id="unselectAllProvidersBtn">全不选</button>
                                        </div>
                                    </div>
                                    
                                    <div class="compact-table-container">
                                        <table class="compact-table" id="userProvidersTable">
                                            <thead>
                                                <tr>
                                                    <th style="width: 50px">启用</th>
                                                    <th>供应商</th>
                                                    <th>API密钥配置</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- 由JavaScript动态填充 -->
                                                <tr>
                                                    <td colspan="3" class="text-center">加载中...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- 模型配置 -->
                                <div class="tab-content" id="modelsConfig">
                                    <div class="table-toolbar">
                                        <span class="section-subtitle">可用模型</span>
                                        <div class="toolbar-actions">
                                            <button class="btn btn-sm btn-outline" id="selectAllModelsBtn">全选</button>
                                            <button class="btn btn-sm btn-outline" id="unselectAllModelsBtn">全不选</button>
                                        </div>
                                    </div>
                                    
                                    <div class="compact-table-container">
                                        <table class="compact-table" id="userModelsTable">
                                            <thead>
                                                <tr>
                                                    <th style="width: 50px">启用</th>
                                                    <th>模型名称</th>
                                                    <th>供应商</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- 由JavaScript动态填充 -->
                                                <tr>
                                                    <td colspan="3" class="text-center">加载中...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="userConfigEmptyState" class="empty-state">
                        <div class="empty-state-icon">👤</div>
                        <p>请先选择要配置的用户</p>
                    </div>
                </section>

                <!-- 订阅管理 -->
                <section id="subscriptionManagement" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>订阅管理</h2>
                        <button class="btn btn-primary" id="addSubscriptionBtn">新增订阅计划</button>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stats-card">
                            <h3>总订阅数</h3>
                            <div class="stats-value" id="totalSubscriptionsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>活跃订阅</h3>
                            <div class="stats-value" id="activeSubscriptionsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>月收入</h3>
                            <div class="stats-value" id="monthlyRevenueValue">--</div>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="subscriptionsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>价格</th>
                                    <th>有效期(天)</th>
                                    <th>API配额</th>
                                    <th>订阅数</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="subscriptionsEmptyState" style="display: none;">
                            <p>暂无订阅计划</p>
                        </div>
                        <div class="loading-state" id="subscriptionsLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>

                <!-- API使用统计 -->
                <section id="apiUsage" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>API使用统计</h2>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stats-card">
                            <h3>今日API调用</h3>
                            <div class="stats-value" id="todayApiCallsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>总API调用</h3>
                            <div class="stats-value" id="totalApiCallsValue">--</div>
                        </div>
                        <div class="stats-card">
                            <h3>活跃用户</h3>
                            <div class="stats-value" id="activeUsersValue">--</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-card">
                            <h3>每日API调用</h3>
                            <div class="chart" id="dailyApiCallsChart">
                                <div class="placeholder-chart">
                                    <p>图表加载中...</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>模型使用分布</h3>
                            <div class="chart" id="modelDistributionChart">
                                <div class="placeholder-chart">
                                    <p>图表加载中...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-header subsection-header">
                        <h3>用户API使用排行</h3>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="apiUsageTable">
                            <thead>
                                <tr>
                                    <th>用户ID</th>
                                    <th>用户名</th>
                                    <th>API调用次数</th>
                                    <th>配额使用比例</th>
                                    <th>常用模型</th>
                                    <th>上次使用时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="apiUsageEmptyState" style="display: none;">
                            <p>暂无API使用数据</p>
                        </div>
                        <div class="loading-state" id="apiUsageLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>

                <!-- 对话模式管理 -->
                <section id="chatModeManagement" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>对话模式管理</h2>
                        <button class="btn btn-primary" id="addChatModeBtn">新增对话模式</button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <label for="chatModeStatusFilter">状态</label>
                            <select id="chatModeStatusFilter">
                                <option value="">全部</option>
                                <option value="active">启用</option>
                                <option value="inactive">禁用</option>
                            </select>
                        </div>
                        <div class="search-box">
                            <input type="text" id="chatModeSearchInput" placeholder="搜索模式名称...">
                            <button id="chatModeSearchBtn" class="btn btn-secondary">搜索</button>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="chatModesTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>模式名称</th>
                                    <th>描述</th>
                                    <th>默认模型</th>
                                    <th>用户可见性</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="chatModesEmptyState" style="display: none;">
                            <p>暂无对话模式数据</p>
                        </div>
                        <div class="loading-state" id="chatModesLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                    
                    <div class="section-header subsection-header">
                        <h3>用户对话模式权限</h3>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <label for="userPermissionChatModeFilter">用户</label>
                            <select id="userPermissionChatModeFilter">
                                <option value="">选择用户...</option>
                                <!-- 用户数据将通过JavaScript动态填充 -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="userChatModeTable">
                            <thead>
                                <tr>
                                    <th>对话模式</th>
                                    <th>权限状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="userChatModeEmptyState" style="display: none;">
                            <p>请先选择用户</p>
                        </div>
                        <div class="loading-state" id="userChatModeLoadingState" style="display: none;">
                            <p>加载中...</p>
                        </div>
                    </div>
                </section>

                <!-- API密钥管理Tab内容 -->
                <section id="apiKeysManagement" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>API密钥管理</h2>
                        <p>管理用户API密钥设置</p>
                    </div>
                    
                    <div class="section-content">
                        <div class="api-keys-container">
                            <div class="mb-4">
                                <p>管理员可以为每个用户配置不同的API密钥，若用户未设置则默认使用OpenRouter API密钥。</p>
                                <button class="btn btn-primary" onclick="setupDefaultApiKeys()">
                                    <i class="bi bi-gear"></i> 设置默认API密钥
                                </button>
                            </div>
                            <div id="apiKeysList">
                                <p class="text-center">正在加载API密钥列表...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 管理员活动日志 -->
                <section id="adminLogs" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>管理员活动日志</h2>
                        <p>管理员操作记录与审计</p>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <select id="actionTypeFilter" class="form-control">
                                <option value="">所有操作类型</option>
                                <option value="user_management">用户管理</option>
                                <option value="config_change">配置变更</option>
                                <option value="api_key_management">API密钥管理</option>
                                <option value="permission_change">权限变更</option>
                                <option value="admin_login">管理员登录</option>
                                <option value="system_settings">系统设置</option>
                            </select>
                        </div>
                        <div class="form-group date-range">
                            <input type="date" id="logStartDate" class="form-control">
                            <span>至</span>
                            <input type="date" id="logEndDate" class="form-control">
                        </div>
                        <button id="filterLogsBtn" class="btn btn-secondary">应用筛选</button>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table" id="adminLogsTable">
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>管理员</th>
                                    <th>操作类型</th>
                                    <th>资源</th>
                                    <th>方法</th>
                                    <th>状态</th>
                                    <th>IP地址</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 由JS动态填充 -->
                            </tbody>
                        </table>
                        <div class="empty-state" id="logsEmptyState" style="display: none;">
                            <p>暂无管理员操作记录</p>
                        </div>
                        <div class="loading-state" id="logsLoadingState">
                            <p>加载中...</p>
                        </div>
                    </div>
                    
                    <div class="pagination" id="logsPagination">
                        <button class="pagination-btn" id="logsPrevBtn" disabled>&laquo; 上一页</button>
                        <span class="pagination-info">第 <span id="logsCurrentPage">1</span> 页，共 <span id="logsTotalPages">1</span> 页</span>
                        <button class="pagination-btn" id="logsNextBtn" disabled>下一页 &raquo;</button>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- 模态框 -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">提示词编辑</h3>
                <button class="close-modal" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="promptForm">
                    <input type="hidden" id="promptId">
                    <div class="form-group">
                        <label for="promptName">名称</label>
                        <input type="text" id="promptName" required placeholder="提示词名称">
                    </div>
                    <div class="form-group">
                        <label for="promptCategory">分类</label>
                        <select id="promptCategory" required>
                            <option value="general">通用对话</option>
                            <option value="patent-search">专利检索</option>
                            <option value="patent-writing">专利撰写</option>
                            <option value="patent-analysis">专利分析</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="promptContent">内容</label>
                        <textarea id="promptContent" rows="8" required placeholder="输入提示词内容..."></textarea>
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="promptIsPublic">
                            <span>公开提示词（所有用户可见）</span>
                        </label>
                    </div>
                    <div class="form-error" id="promptFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPromptBtn">取消</button>
                <button class="btn btn-primary" id="savePromptBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="deleteModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="close-modal" id="closeDeleteModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除这个提示词吗？此操作无法撤销。</p>
                <input type="hidden" id="deletePromptId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- 用户编辑模态框 -->
    <div id="userModalOverlay" class="modal-overlay" style="display: none !important;">
        <div class="modal-container user-modal">
            <div class="modal-header">
                <h2 id="userModalTitle">编辑用户</h2>
                <button id="closeUserModalBtn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    
                    <div class="form-group">
                        <label for="userUsername">用户名</label>
                        <input type="text" id="userUsername" class="form-control" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label for="userEmail">邮箱</label>
                        <input type="email" id="userEmail" class="form-control" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label for="userRole">角色</label>
                        <select id="userRole" class="form-control">
                            <option value="basic">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="userApiQuota">API配额</label>
                        <input type="number" id="userApiQuota" class="form-control" min="0">
                    </div>
                    
                    <!-- 权限设置 -->
                    <div class="mb-3">
                        <label class="form-label">权限设置</label>
                        <div id="userPermissionsContainer" class="border rounded p-3">
                            <div id="userPermissionsLoading" class="my-2">正在加载权限...</div>
                            <div id="userPermissionsError" class="alert alert-danger d-none" role="alert"></div>
                            <div id="userPermissionsList" class="d-none"></div>
                        </div>
                    </div>

                    <!-- API密钥管理 -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label mb-0">API密钥管理</label>
                            <button type="button" id="addUserApiKeyBtn" class="btn btn-sm btn-outline-primary">添加API密钥</button>
                        </div>
                        <div class="api-keys-container">
                            <div id="userApiKeysLoading" class="loading-indicator">正在加载API密钥...</div>
                            <div id="userApiKeysError" class="error-message d-none"></div>
                            <div id="userApiKeysList" class="api-keys-list d-none"></div>
                        </div>
                    </div>
                    
                    <div class="error-message" id="userFormError"></div>
                    
                    <div class="form-actions">
                        <button type="button" id="saveUserBtn" class="btn btn-primary">保存</button>
                        <button type="button" id="cancelUserBtn" class="btn btn-secondary">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 角色修改确认模态框 -->
    <div id="roleConfirmModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认角色修改</h3>
                <button class="close-modal" id="closeRoleConfirmModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>您确定要将用户 <span id="roleChangeUsername"></span> 的角色从 <span id="roleChangeOld"></span> 修改为 <span id="roleChangeNew"></span> 吗？</p>
                <p class="warning-text">此操作会影响用户的权限，请谨慎操作。</p>
                <input type="hidden" id="roleChangeUserId">
                <input type="hidden" id="roleChangeValue">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRoleChangeBtn">取消</button>
                <button class="btn btn-primary" id="confirmRoleChangeBtn">确认修改</button>
            </div>
        </div>
    </div>

    <!-- 订阅计划编辑模态框 -->
    <div id="subscriptionModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="subscriptionModalTitle">订阅计划编辑</h3>
                <button class="close-modal" id="closeSubscriptionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="subscriptionForm">
                    <input type="hidden" id="subscriptionId">
                    <div class="form-group">
                        <label for="subscriptionName">名称</label>
                        <input type="text" id="subscriptionName" required placeholder="订阅计划名称">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionPrice">价格 (元/月)</label>
                        <input type="number" id="subscriptionPrice" min="0" step="0.01" required placeholder="月度价格">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionDuration">有效期 (天)</label>
                        <input type="number" id="subscriptionDuration" min="1" required placeholder="默认30天">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionApiQuota">API调用配额</label>
                        <input type="number" id="subscriptionApiQuota" min="1" required placeholder="API调用次数">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionFeatures">功能列表</label>
                        <div class="feature-list" id="featureList">
                            <div class="feature-item">
                                <input type="text" placeholder="功能描述">
                                <button type="button" class="btn-icon remove-feature">×</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" id="addFeatureBtn">添加功能</button>
                    </div>
                    <div class="form-error" id="subscriptionFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSubscriptionBtn">取消</button>
                <button class="btn btn-primary" id="saveSubscriptionBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 删除订阅确认模态框 -->
    <div id="deleteSubscriptionModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="close-modal" id="closeDeleteSubscriptionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除这个订阅计划吗？此操作无法撤销，且可能影响已使用此计划的用户。</p>
                <input type="hidden" id="deleteSubscriptionId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteSubscriptionBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteSubscriptionBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- 删除用户确认模态框 -->
    <div id="deleteUserModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除用户</h3>
                <button class="close-modal" id="closeDeleteUserModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除用户 <span id="deleteUserName"></span> 吗？</p>
                <p class="warning-text">此操作无法撤销，用户的所有数据将被永久删除。</p>
                <input type="hidden" id="deleteUserId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteUserBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteUserBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- 新增用户模态框 -->
    <div id="addUserModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>新增用户</h3>
                <button class="close-modal" id="closeAddUserModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">用户名</label>
                        <input type="text" id="newUsername" required placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="newEmail">邮箱</label>
                        <input type="email" id="newEmail" required placeholder="请输入邮箱">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">密码</label>
                        <input type="password" id="newPassword" required placeholder="请输入密码">
                    </div>
                    <div class="form-group">
                        <label for="newRole">角色</label>
                        <select id="newRole">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newApiQuota">API配额</label>
                        <input type="number" id="newApiQuota" min="0" step="10" value="100">
                    </div>
                    <div class="form-error" id="addUserFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddUserBtn">取消</button>
                <button class="btn btn-primary" id="saveAddUserBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 领域特定模板编辑模态框 -->
    <div id="domainTemplateModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal large-modal">
            <div class="modal-header">
                <h3 id="domainTemplateModalTitle">领域特定模板编辑</h3>
                <button class="close-modal" id="closeDomainTemplateModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="domainTemplateForm">
                    <input type="hidden" id="domainTemplateId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="domainTemplateCategory">技术领域</label>
                            <select id="domainTemplateCategory" required>
                                <!-- JS动态填充 -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="domainTemplateMode">对话模式</label>
                            <select id="domainTemplateMode" required>
                                <!-- JS动态填充 -->
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="domainTemplateName">名称</label>
                        <input type="text" id="domainTemplateName" required placeholder="模板名称">
                    </div>
                    <div class="form-group">
                        <label for="domainTemplateSystemPrompt">系统提示词</label>
                        <textarea id="domainTemplateSystemPrompt" rows="8" required placeholder="输入系统提示词内容..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="domainTemplatePlaceholder">输入框占位文本</label>
                        <input type="text" id="domainTemplatePlaceholder" required placeholder="输入框占位文本">
                    </div>
                    <div class="form-error" id="domainTemplateFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDomainTemplateBtn">取消</button>
                <button class="btn btn-primary" id="saveDomainTemplateBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 删除领域特定模板确认模态框 -->
    <div id="deleteDomainTemplateModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>确认删除领域特定模板</h3>
                <button class="close-modal" id="closeDeleteDomainTemplateModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除 <span id="deleteDomainTemplateName"></span> 吗？</p>
                <p class="warning-text">此操作无法撤销</p>
                <input type="hidden" id="deleteDomainTemplateId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteDomainTemplateBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteDomainTemplateBtn">删除</button>
            </div>
        </div>
    </div>

    <!-- API密钥添加/编辑模态框 -->
    <div id="userApiKeyModalOverlay" class="modal-overlay">
        <div class="modal-container" style="max-width: 500px;">
            <div class="modal-header">
                <h3>添加新API密钥</h3>
                <button type="button" id="closeUserApiKeyModalBtn" class="close-btn">×</button>
            </div>
            <div class="modal-body">
                <form id="userApiKeyForm">
                    <input type="hidden" id="userApiKeyUserId">
                    
                    <div class="mb-3">
                        <label for="userApiKeyProvider" class="form-label">服务提供商</label>
                        <select id="userApiKeyProvider" class="form-select">
                            <option value="">-- 请选择 --</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="google">Google</option>
                            <option value="azure">Azure</option>
                            <option value="zhipu">智谱AI</option>
                            <option value="baidu">百度文心</option>
                            <option value="xunfei">讯飞星火</option>
                            <option value="aliyun">阿里通义</option>
                            <option value="minimax">MiniMax</option>
                            <option value="mistral">Mistral AI</option>
                            <option value="custom">自定义</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="userApiKeyValue" class="form-label">API密钥值</label>
                        <input type="password" id="userApiKeyValue" class="form-control" placeholder="输入API密钥">
                        <div class="form-text">密钥将被安全加密存储</div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" id="userApiKeyActive" class="form-check-input" checked>
                            <label class="form-check-label" for="userApiKeyActive">启用此密钥</label>
                        </div>
                    </div>
                    
                    <div id="userApiKeyFormError" class="alert alert-danger d-none" role="alert"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="saveUserApiKeyBtn" class="btn btn-primary">保存</button>
                <button type="button" id="cancelUserApiKeyBtn" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 对话模式编辑模态框 -->
    <div id="chatModeModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="chatModeModalTitle">编辑对话模式</h3>
                <button class="close-modal" id="closeChatModeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="chatModeForm" class="compact-form">
                    <input type="hidden" id="chatModeId">
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="chatModeName">模式名称</label>
                            <input type="text" id="chatModeName" required placeholder="输入对话模式名称">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="chatModeStatus">状态</label>
                            <select id="chatModeStatus">
                                <option value="active">启用</option>
                                <option value="inactive">禁用</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="chatModeDescription">简短描述</label>
                        <input type="text" id="chatModeDescription" placeholder="简要描述该对话模式的用途">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="chatModeDefaultModel">默认模型</label>
                            <select id="chatModeDefaultModel">
                                <option value="gpt-3.5-turbo">GPT-3.5-Turbo</option>
                                <option value="gpt-4">GPT-4</option>
                                <option value="gpt-4-turbo">GPT-4-Turbo</option>
                                <option value="claude-3-opus">Claude-3-Opus</option>
                                <option value="claude-3-sonnet">Claude-3-Sonnet</option>
                                <!-- 其他模型选项将从API动态加载 -->
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="chatModeProvider">API供应商</label>
                            <select id="chatModeProvider">
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="openrouter">OpenRouter</option>
                                <!-- 其他供应商选项将从API动态加载 -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="chatModePrompt">系统提示词</label>
                        <textarea id="chatModePrompt" rows="4" placeholder="输入系统提示词以定义对话行为..."></textarea>
                    </div>
                    
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="chatModeRequiresAuth">
                            <span>需要身份验证</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="chatModeIsDefault">
                            <span>设为默认模式</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>适用用户角色</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="chatModeForBasic" checked>
                                <span>普通用户</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="chatModeForPremium" checked>
                                <span>高级用户</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="chatModeForAdmin" checked>
                                <span>管理员</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>高级设置</label>
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="chatModeTemperature">Temperature</label>
                                <input type="number" id="chatModeTemperature" min="0" max="2" step="0.1" value="0.7">
                            </div>
                            <div class="form-group col-md-4">
                                <label for="chatModeMaxTokens">最大Tokens</label>
                                <input type="number" id="chatModeMaxTokens" min="100" max="32000" step="100" value="4000">
                            </div>
                            <div class="form-group col-md-4">
                                <label for="chatModeFrequencyPenalty">Frequency Penalty</label>
                                <input type="number" id="chatModeFrequencyPenalty" min="-2" max="2" step="0.1" value="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-error" id="chatModeFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelChatModeBtn">取消</button>
                <button class="btn btn-primary" id="saveChatModeBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 用户对话模式权限编辑模态框 -->
    <div id="userChatModePermissionModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal small-modal">
            <div class="modal-header">
                <h3>编辑用户对话模式权限</h3>
                <button class="close-modal" id="closeUserChatModePermissionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>用户: <span id="permissionModalUsername"></span></label>
                </div>
                <div class="form-group">
                    <label>对话模式: <span id="permissionModalChatModeName"></span></label>
                </div>
                <div class="form-group">
                    <label for="permissionStatus">权限状态</label>
                    <select id="permissionStatus" class="form-control">
                        <option value="allow">允许</option>
                        <option value="deny">禁止</option>
                    </select>
                </div>
                <input type="hidden" id="permissionUserId">
                <input type="hidden" id="permissionChatModeId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPermissionBtn">取消</button>
                <button class="btn btn-primary" id="savePermissionBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- API提供商管理模态框 -->
    <div id="apiProviderModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="apiProviderModalTitle">API提供商管理</h3>
                <button class="close-modal" id="closeApiProviderModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="apiProviderForm" class="compact-form">
                    <input type="hidden" id="apiProviderId">
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="apiProviderName">提供商名称</label>
                            <input type="text" id="apiProviderName" required placeholder="如OpenAI、Anthropic">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="apiProviderStatus">状态</label>
                            <select id="apiProviderStatus">
                                <option value="active">启用</option>
                                <option value="inactive">禁用</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="apiEndpoint">API端点</label>
                        <input type="text" id="apiEndpoint" placeholder="https://api.openai.com/v1">
                    </div>
                    
                    <div class="form-group">
                        <label for="defaultApiKey">默认API密钥</label>
                        <input type="password" id="defaultApiKey" placeholder="默认API密钥">
                        <small class="form-text text-muted">此密钥将用于没有单独配置密钥的用户</small>
                    </div>
                    
                    <div class="form-group">
                        <label>支持的模型</label>
                        <div id="supportedModels">
                            <div class="model-item">
                                <input type="text" placeholder="模型名称" class="model-name">
                                <button type="button" class="btn-icon remove-model">×</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline" id="addModelBtn">
                            <span>+ 添加模型</span>
                        </button>
                    </div>

                    <div class="form-error" id="apiProviderFormError"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelApiProviderBtn">取消</button>
                <button class="btn btn-primary" id="saveApiProviderBtn">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 用户API密钥管理模态框 -->
    <div id="userApiKeyModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>用户API密钥配置</h3>
                <button class="close-modal" id="closeUserApiKeyModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>用户: <span id="apiKeyModalUsername"></span></label>
                </div>
                
                <div class="form-group">
                    <label for="useDefaultApiKeys">API密钥配置方式</label>
                    <select id="useDefaultApiKeys" class="form-control">
                        <option value="default">使用系统默认密钥</option>
                        <option value="custom">使用自定义密钥</option>
                    </select>
                </div>
                
                <div id="customApiKeysContainer" style="display: none;">
                    <div id="apiKeysList">
                        <!-- 动态生成的API密钥输入框将显示在这里 -->
                    </div>
                    
                    <template id="apiKeyItemTemplate">
                        <div class="api-key-item">
                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label>提供商</label>
                                    <select class="provider-select form-control"></select>
                                </div>
                                <div class="form-group col-md-8">
                                    <label>API密钥</label>
                                    <div class="input-group">
                                        <input type="password" class="api-key-input form-control">
                                        <button type="button" class="btn btn-icon toggle-password">👁️</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <button type="button" class="btn btn-sm btn-outline" id="addApiKeyBtn">
                        <span>+ 添加API密钥</span>
                    </button>
                </div>
                
                <input type="hidden" id="apiKeyUserId">
                <div class="form-error" id="userApiKeyFormError"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUserApiKeyBtn">取消</button>
                <button class="btn btn-primary" id="saveUserApiKeyBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="js/theme.js?v=1.3"></script>
    <script src="js/backend-api.js?v=1.0"></script>
    <!-- 本地回退方案 - 确保Chart.js对象存在 -->
    <script>
        // 检查Chart对象是否已加载
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js库加载失败，尝试使用本地方案');
                // 显示错误信息在图表容器中
                const chartContainers = document.querySelectorAll('.chart');
                chartContainers.forEach(container => {
                    container.innerHTML = '<div class="placeholder-chart"><p>图表库加载失败，请检查网络连接</p></div>';
                });
            } else {
                console.log('Chart.js库加载成功，版本:', Chart.version);
            }
        });
    </script>
    <script src="js/admin.js?v=1.0"></script>
</body>
</html> 