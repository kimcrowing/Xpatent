<!DOCTYPE html>
<html lang="zh-CN" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Xpat - 用简单的方式革新世界</title>
    <link rel="stylesheet" href="css/style.css?v=1.3">
    <link rel="stylesheet" href="css/dark-theme.css?v=1.3">
    <link rel="stylesheet" href="css/light-theme.css?v=1.3">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQgMkM3LjM3MyAyIDIgNy4zNzMgMiAxNEMyIDIwLjYyNyA3LjM3MyAyNiAxNCAyNkMyMC42MjcgMjYgMjYgMjAuNjI3IDI2IDE0QzI2IDcuMzczIDIwLjYyNyAyIDE0IDJaTTE0IDVDMTguNDE4IDUgMjIgOC41ODIgMjIgMTNDMjIgMTcuNDE4IDE4LjQxOCAyMSAxNCAyMUM5LjU4MiAyMSA2IDE3LjQxOCA2IDEzQzYgOC41ODIgOS41ODIgNSAxNCA1WiIgZmlsbD0iIzU4NjVmMiIvPjwvc3ZnPg==" type="image/svg+xml">
    <!-- PDF.js 库 -->
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <!-- mammoth.js 库 (用于Word文档) -->
    <script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <!-- marked.js 库 (用于Markdown解析) -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <style>
        /* API配置模态窗口样式 */
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            -webkit-backdrop-filter: blur(2px);
            backdrop-filter: blur(2px);
        }
        
        .modal-content {
            position: relative;
            background-color: var(--menu-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 2001;
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .close-btn {
            background: transparent;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .secondary-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        
        .primary-btn {
            background-color: var(--primary-color, #5865f2);
            color: white;
        }
        
        .secondary-btn:hover {
            background-color: var(--hover-color);
        }
        
        .primary-btn:hover {
            opacity: 0.9;
        }
        
        .form-control {
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body class="dark-theme">
    <div class="app-container">
        <!-- 登录页面 -->
        <div id="loginPage" class="auth-page" style="display:flex;">
            <div class="auth-container">
                <div class="auth-branding">
                    <div class="logo">
                        <svg width="48" height="48" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2C7.373 2 2 7.373 2 14C2 20.627 7.373 26 14 26C20.627 26 26 20.627 26 14C26 7.373 20.627 2 14 2ZM14 5C18.418 5 22 8.582 22 13C22 17.418 18.418 21 14 21C9.582 21 6 17.418 6 13C6 8.582 9.582 5 14 5Z" fill="#5865f2"/>
                        </svg>
                        <h1>Xpat</h1>
                    </div>
                    <p class="slogan">用简单的方式革新世界</p>
                </div>
                <div class="auth-card">
                    <div class="auth-header">
                        <h2>登录</h2>
                        <p>欢迎使用Xpat，请登录您的账户</p>
                    </div>
                    <form id="loginForm" class="auth-form">
                        <div class="form-group">
                            <label for="loginEmail">邮箱</label>
                            <input type="email" id="loginEmail" placeholder="请输入邮箱地址" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">密码</label>
                            <input type="password" id="loginPassword" placeholder="请输入密码" required>
                        </div>
                        <div class="form-error" id="loginError"></div>
                        <button type="submit" class="btn btn-primary btn-block">登录</button>
                    </form>
                    <div class="auth-footer">
                        <p>还没有账户？ <a href="#" id="showRegisterBtn">立即注册</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 注册页面 -->
        <div id="registerPage" class="auth-page" style="display:none;">
            <div class="auth-container">
                <div class="auth-branding">
                    <div class="logo">
                        <svg width="48" height="48" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2C7.373 2 2 7.373 2 14C2 20.627 7.373 26 14 26C20.627 26 26 20.627 26 14C26 7.373 20.627 2 14 2ZM14 5C18.418 5 22 8.582 22 13C22 17.418 18.418 21 14 21C9.582 21 6 17.418 6 13C6 8.582 9.582 5 14 5Z" fill="#5865f2"/>
                        </svg>
                        <h1>Xpat</h1>
                    </div>
                    <p class="slogan">用简单的方式革新世界</p>
                </div>
                <div class="auth-card">
                    <div class="auth-header">
                        <h2>注册</h2>
                        <p>创建您的Xpat账户，开始革新之旅</p>
                    </div>
                    <form id="registerForm" class="auth-form">
                        <div class="form-group">
                            <label for="registerUsername">用户名</label>
                            <input type="text" id="registerUsername" placeholder="请设置用户名" required>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">邮箱</label>
                            <input type="email" id="registerEmail" placeholder="请输入邮箱地址" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">密码</label>
                            <input type="password" id="registerPassword" placeholder="请设置密码" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPasswordConfirm">确认密码</label>
                            <input type="password" id="registerPasswordConfirm" placeholder="请再次输入密码" required>
                        </div>
                        <div class="form-error" id="registerError"></div>
                        <button type="submit" class="btn btn-primary btn-block">注册</button>
                    </form>
                    <div class="auth-footer">
                        <p>已有账户？ <a href="#" id="showLoginBtn">立即登录</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主应用页面 -->
        <div id="appContent" style="display:none;">
            <!-- 页头 -->
            <header class="navbar">
                <div class="logo">
                    <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2C7.373 2 2 7.373 2 14C2 20.627 7.373 26 14 26C20.627 26 26 20.627 26 14C26 7.373 20.627 2 14 2ZM14 5C18.418 5 22 8.582 22 13C22 17.418 18.418 21 14 21C9.582 21 6 17.418 6 13C6 8.582 9.582 5 14 5Z" fill="white"/>
                    </svg>
                    <span>Xpat</span>
                </div>
                <div class="nav-controls">
                    <button class="icon-btn notification-btn" title="通知">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2C6.68632 2 4 4.68632 4 8V13.5858L3.29289 14.2929C3.10536 14.4804 3 14.7348 3 15V16C3 16.5523 3.44772 17 4 17H16C16.5523 17 17 16.5523 17 16V15C17 14.7348 16.8946 14.4804 16.7071 14.2929L16 13.5858V8C16 4.68632 13.3137 2 10 2ZM10 20C8.89543 20 8 19.1046 8 18H12C12 19.1046 11.1046 20 10 20Z" fill="white"/>
                        </svg>
                    </button>
                    <button class="icon-btn feature-btn" id="featureMenuBtn" title="功能菜单">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z" fill="white"/>
                            <path d="M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z" fill="white"/>
                            <path d="M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z" fill="white"/>
                        </svg>
                    </button>
                    <button class="icon-btn user-btn" id="userMenuBtn" title="用户设置">
                        <div class="user-avatar">KQ</div>
                    </button>
                </div>
            </header>

            <!-- 聊天区域 -->
            <div class="chat-container">
                <div class="messages" id="chatMessages">
                    <div class="welcome-message">
                        <h2>欢迎使用 Xpat</h2>
                        <p>请输入您的问题，我将为您提供帮助</p>
                    </div>
                </div>
                <div class="input-area">
                    <div class="unified-input-container">
                        <!-- 上行：文本输入和发送按钮 -->
                        <div class="input-wrapper">
                            <input type="file" id="fileUpload" accept=".pdf,.doc,.docx" style="display: none;">
                            <input type="text" id="userInput" placeholder="您想了解什么?">
                            <button class="send-btn" id="sendButton" title="发送消息">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3.49184 15.9892C2.97752 16.5035 2.97716 17.3378 3.49148 17.8521C4.0058 18.3665 4.84008 18.3668 5.3544 17.8525L10.9582 12.2487C11.3545 11.8524 11.3545 11.2126 10.9582 10.8163L5.36152 5.21967C4.8472 4.70535 4.01292 4.70535 3.4986 5.21967C2.98428 5.73399 2.98428 6.56827 3.4986 7.08259L8.06107 11.6325L3.49184 15.9892Z" fill="white"/>
                                    <path d="M9.49184 15.9892C8.97752 16.5035 8.97716 17.3378 9.49148 17.8521C10.0058 18.3665 10.8401 18.3668 11.3544 17.8525L16.9582 12.2487C17.3545 11.8524 17.3545 11.2126 16.9582 10.8163L11.3615 5.21967C10.8472 4.70535 10.0129 4.70535 9.4986 5.21967C8.98428 5.73399 8.98428 6.56827 9.4986 7.08259L14.0611 11.6325L9.49184 15.9892Z" fill="white"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- 下行：附件指示器和模型选择器 -->
                        <div class="controls-bar">
                            <div class="left-controls">
                                <button class="icon-btn" id="attachButton" title="上传附件">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l8.57-8.57A4 4 0 1118 8.84l-8.59 8.57a2 2 0 01-2.83-2.83l8.49-8.48" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                                <div id="attachmentInfo" style="display: none;">
                                    <span id="fileName"></span>
                                    <button id="removeAttachment" title="移除附件">×</button>
                                </div>
                            </div>
                            <div class="right-controls">
                                <!-- 聊天模式选择按钮 -->
                                <button class="icon-btn chat-mode-selector" id="chatModeSelector" title="选择聊天模式">
                                    <span id="currentChatMode">通用对话</span>
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5.29289 7.29289C5.68342 6.90237 6.31658 6.90237 6.70711 7.29289L10 10.5858L13.2929 7.29289C13.6834 6.90237 14.3166 6.90237 14.7071 7.29289C15.0976 7.68342 15.0976 8.31658 14.7071 8.70711L10.7071 12.7071C10.3166 13.0976 9.68342 13.0976 9.29289 12.7071L5.29289 8.70711C4.90237 8.31658 4.90237 7.68342 5.29289 7.29289Z" fill="white"/>
                                    </svg>
                                </button>
                                
                                <!-- 模型选择按钮 -->
                                <button class="icon-btn model-selector" id="modelSelector" title="选择AI模型">
                                    <span id="currentModel">Deepseek</span>
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5.29289 7.29289C5.68342 6.90237 6.31658 6.90237 6.70711 7.29289L10 10.5858L13.2929 7.29289C13.6834 6.90237 14.3166 6.90237 14.7071 7.29289C15.0976 7.68342 15.0976 8.31658 14.7071 8.70711L10.7071 12.7071C10.3166 13.0976 9.68342 13.0976 9.29289 12.7071L5.29289 8.70711C4.90237 8.31658 4.90237 7.68342 5.29289 7.29289Z" fill="white"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="feature-indicator" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 在页脚添加API配置模态窗口 -->
    <div class="modal-container" id="apiConfigModalContainer" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="width: 500px; max-width: 90%;">
            <div class="modal-header">
                <h2>后端API配置</h2>
                <button class="close-btn" id="closeApiConfigModal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="apiUrlInput" style="display: block; margin-bottom: 8px; font-weight: bold;">API地址</label>
                    <input type="text" id="apiUrlInput" class="form-control" 
                          placeholder="例如: http://localhost:3000/api" 
                          style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc;">
                    <div class="form-text" style="margin-top: 5px; font-size: 0.9em; color: #888;">
                        设置后端API服务器地址，离线使用时需要指向您本地运行的后端服务
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelApiConfig" class="btn secondary-btn">取消</button>
                <button id="saveApiConfig" class="btn primary-btn">保存</button>
            </div>
        </div>
    </div>

    <script src="js/theme.js?v=1.3"></script>
    <script src="js/backend-api.js?v=1.0"></script>
    <script src="js/app.js?v=1.0"></script>
</body>
</html> 